"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2811],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return d}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),l=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},u=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=l(r),d=a,h=m["".concat(p,".").concat(d)]||m[d]||c[d]||i;return r?n.createElement(h,o(o({ref:t},u),{},{components:r})):n.createElement(h,o({ref:t},u))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=r[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},64:function(e,t,r){r.r(t),r.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var n=r(7462),a=r(3366),i=(r(7294),r(3905)),o=["components"],s={title:"Monitoring Go apps with Distributed Tracing and OpenTelemetry",slug:"monitoring-go-apps-with-distributed-tracing-and-opentelemetry",tags:["Uptrace","OpenTelemetry"],author:"Vladimir Mihailenco"},p=void 0,l={permalink:"/monitoring-go-apps-with-distributed-tracing-and-opentelemetry",source:"@site/blog/2022-04-18-monitoring-go-apps-with-distributed-tracing-and-opentelemetry.md",title:"Monitoring Go apps with Distributed Tracing and OpenTelemetry",description:"This article gives a brief introduction into monitoring Go applications using OpenTelemetry and Uptrace.",date:"2022-04-18T00:00:00.000Z",formattedDate:"April 18, 2022",tags:[{label:"Uptrace",permalink:"/tags/uptrace"},{label:"OpenTelemetry",permalink:"/tags/open-telemetry"}],readingTime:3.925,truncated:!0,authors:[{name:"Vladimir Mihailenco"}],frontMatter:{title:"Monitoring Go apps with Distributed Tracing and OpenTelemetry",slug:"monitoring-go-apps-with-distributed-tracing-and-opentelemetry",tags:["Uptrace","OpenTelemetry"],author:"Vladimir Mihailenco"},prevItem:{title:"\u5361\u7247\u7b14\u8bb0\u5199\u4f5c\u6cd5 - \u8bfb\u4e66\u7b14\u8bb0",permalink:"/posts-writing-by-notes"},nextItem:{title:"\u5982\u4f55\u57fa\u4e8e\u78c1\u76d8 KV \u5b9e\u73b0 Bitmap",permalink:"/posts-how-to-impl-bitmap-on-disk-kv"}},u={authorsImageUrls:[void 0]},c=[{value:"What is OpenTelemetry?",id:"what-is-opentelemetry",level:2},{value:"How to use OpenTelemetry?",id:"how-to-use-opentelemetry",level:2},{value:"What is tracing?",id:"what-is-tracing",level:2},{value:"OpenTelemetry API",id:"opentelemetry-api",level:2},{value:"What is Uptrace?",id:"what-is-uptrace",level:2},{value:"Metrics monitoring",id:"metrics-monitoring",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],m={toc:c};function d(e){var t=e.components,r=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This article gives a brief introduction into monitoring Go applications using OpenTelemetry and Uptrace."),(0,i.kt)("h2",{id:"what-is-opentelemetry"},"What is OpenTelemetry?"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/"},"OpenTelemetry")," is an open source and vendor-neutral API for ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/distributed-tracing.html"},"distributed tracing")," (including logs and errors) and ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/metrics.html"},"OpenTelemetry metrics"),"."),(0,i.kt)("p",null,"It specifies how to collect and export telemetry data in a vendor agnostic way. With OpenTelemetry, you can instrument your application once and then add or change vendors without changing the instrumentation, for example, many ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/blog/distributed-tracing-tools.html"},"open source tracing tools")," already support OpenTelemetry."),(0,i.kt)("p",null,"By being vendor-neutral, OpenTelemetry makes it possible to try different products with minimal efforts and avoid being stuck with a vendor forever."),(0,i.kt)("p",null,"OpenTelemetry also enables different companies to work together on maintaining a single framework instead of duplicating efforts in proprietary projects which benefits everyone. It also means that OpenTelemetry works almost everywhere and you can trace requests across different languages, platforms, and even clouds."),(0,i.kt)("h2",{id:"how-to-use-opentelemetry"},"How to use OpenTelemetry?"),(0,i.kt)("p",null,"The easiest way to get started with OpenTelemetry is to pick an ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/blog/opentelemetry-backend.html"},"OpenTelemetry backend")," (vendor) and follow the documentation. Most vendors provide pre-configured OpenTelemetry distros that allow you to skip some steps and can significantly improve your experience."),(0,i.kt)("p",null,"If you are looking for an open source solution, Jaeger is historically the default choice, but Uptrace provides more features and might be a better choice nowadays."),(0,i.kt)("p",null,"Uptrace is an ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/get/open-source-apm.html"},"open source APM")," for OpenTelemetry that uses ClickHouse database to store traces, metrics, and logs. You can use it to monitor applications and set up automatic alerts to receive notifications via email, Slack, Telegram, and more."),(0,i.kt)("h2",{id:"what-is-tracing"},"What is tracing?"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/distributed-tracing.html"},"Distributed tracing")," allows to observe requests as they propagate through distributed systems, especially those built using a microservices architecture."),(0,i.kt)("p",null,"Tracing provides insights into your app performance along with any errors and logs. You immediately see what conditions cause errors and how particular error affects app performance."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/git-hulk/git-hulk.github.io/images/monitoring/tracing-graph.png",alt:"image"})),(0,i.kt)("p",null,"Using tracing, you can break down requests into ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/distributed-tracing.html#spans"},"spans"),". ",(0,i.kt)("strong",{parentName:"p"},"Span")," is an operation (unit of work) your app performs handling a request, for example, a database query or a network call."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Trace")," is a tree of spans that shows the path that a request makes through an app. Root span is the first span in a trace."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/git-hulk/git-hulk.github.io/images/monitoring/trace-graph.png",alt:"image"})),(0,i.kt)("p",null,"To learn more about tracing, see ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/distributed-tracing.html"},"Distributed tracing using OpenTelemetry"),"."),(0,i.kt)("h2",{id:"opentelemetry-api"},"OpenTelemetry API"),(0,i.kt)("p",null,"OpenTelemetry API is a programming interface that you can use to instrument code to collect telemetry data such as traces, metrics, and logs."),(0,i.kt)("p",null,"You can create spans using OpenTelemetry API for Go like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'import "go.opentelemetry.io/otel"\n\nvar tracer = otel.Tracer("app_or_package_name")\n\nfunc someFunc(ctx context.Context) error {\n    ctx, span := tracer.Start(ctx, "some-func")\n    defer span.End()\n\n    // the code you are measuring\n\n    return nil\n}\n')),(0,i.kt)("p",null,"You can also record ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/distributed-tracing.html#attributes"},"attributes")," and errors:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'func someFunc(ctx context.Context) error {\n    ctx, span := tracer.Start(ctx, "some-func")\n    defer span.End()\n\n    if span.IsRecording() {\n        span.SetAttributes(\n            attribute.Int64("enduser.id", userID),\n            attribute.String("enduser.email", userEmail),\n        )\n    }\n\n    if err := someOtherFunc(ctx); err != nil {\n        span.RecordError(err)\n        span.SetStatus(codes.Error, err.Error())\n    }\n\n    return nil\n}\n')),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/go-tracing.html"},"OpenTelemetry Go API")," for details."),(0,i.kt)("h2",{id:"what-is-uptrace"},"What is Uptrace?"),(0,i.kt)("p",null,"Uptrace is an ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/get/open-source-apm.html"},"open source APM")," with an intuitive query builder, rich dashboards, automatic alerts, and integrations for most languages and frameworks."),(0,i.kt)("p",null,"Uptrace accepts data from OpenTelemetry and stores it in a ClickHouse database. ClickHouse is a columnar database that is much more efficient for traces and logs than, for example, Elastic Search. On the same hardware, ClickHouse can store 10x more traces and, at the same time, provide much better performance."),(0,i.kt)("p",null,"You can ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/get/install.html"},"install")," Uptrace by downloading a DEB/RPM package or a pre-compiled binary."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/git-hulk/git-hulk.github.io/images/monitoring/uptrace.png",alt:"image"})),(0,i.kt)("h2",{id:"metrics-monitoring"},"Metrics monitoring"),(0,i.kt)("p",null,"Uptrace also allows you to monitor metrics using Prometheus-like alerting rules. For example, the following monitor uses the group by node expression to create an alert whenever an individual Redis shard is down:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"monitors:\n  - name: Redis shard is down\n    metrics:\n      - redis_up as $redis_up\n    query:\n      - group by cluster # monitor each cluster,\n      - group by bdb # each database,\n      - group by node # and each shard\n      - $redis_up\n    min_allowed_value: 1\n    # shard should be down for 5 minutes to trigger an alert\n    for_duration: 5m\n")),(0,i.kt)("p",null,"You can also create queries with more complex expressions. For example, the following rules create an alert when the keyspace hit rate is lower than 75% or memory fragmentation is too high:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"monitors:\n  - name: Redis read hit rate < 75%\n    metrics:\n      - redis_keyspace_read_hits as $hits\n      - redis_keyspace_read_misses as $misses\n    query:\n      - group by cluster\n      - group by bdb\n      - group by node\n      - $hits / ($hits + $misses) as hit_rate\n    min_allowed_value: 0.75\n    for_duration: 5m\n")),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/get/alerting.html"},"Alerting and Notifications")," for details."),(0,i.kt)("h2",{id:"whats-next"},"What's next?"),(0,i.kt)("p",null,"Next, you can continue exploring ",(0,i.kt)("a",{parentName:"p",href:"https://uptrace.dev/opentelemetry/"},"OpenTelemetry")," or start instrumenting your app using popular instrumentations:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://uptrace.dev/get/instrument/opentelemetry-gin.html"},"OpenTelemetry Gin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://uptrace.dev/get/instrument/opentelemetry-go-grpc.html"},"OpenTelemetry Go gRPC")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://uptrace.dev/get/instrument/opentelemetry-database-sql.html"},"OpenTelemetry database/sql")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://uptrace.dev/get/monitor/opentelemetry-redis.html"},"OpenTelemetry Redis"))))}d.isMDXComponent=!0}}]);